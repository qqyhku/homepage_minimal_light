<!-- ClustrMaps Visitor Map -->
<div class="visitor-map-section">
  <h3>üåç Visitor Map</h3>
  <div id="visitor-map" style="width: 300px; height: 300px; border-radius: 8px; overflow: hidden; margin: 20px auto; background: #f8f9fa; display: flex; align-items: center; justify-content: center;">
    <div id="map-loading" style="text-align: center; color: #666;">
      <p>Loading ClustrMaps...</p>
    </div>
  </div>
  <p style="font-size: 0.9em; color: #666; text-align: center; margin-top: 10px;">
    <span id="visitor-stats">Loading visitor statistics...</span>
  </p>
</div>

<style>
.visitor-map-section {
  margin: 30px 0;
  padding: 20px;
  background: rgba(255, 255, 255, 0.05);
  border-radius: 12px;
  border: 1px solid rgba(255, 255, 255, 0.1);
}

.visitor-map-section h3 {
  margin: 0 0 15px 0;
  color: var(--text-color);
  font-size: 1.2em;
}

@media (prefers-color-scheme: dark) {
  .visitor-map-section {
    background: rgba(0, 0, 0, 0.2);
    border: 1px solid rgba(255, 255, 255, 0.1);
  }
}

/* ClustrMaps widget styling */
.clustrmaps-widget {
  border-radius: 8px;
  overflow: hidden;
}
</style>

<script>
// ClustrMaps Widget Code
// You can get your custom widget code from https://clustrmaps.com/
// This is a sample widget - replace with your actual ClustrMaps widget code

// ClustrMaps Widget Code - Your actual widget is loaded below

// Your ClustrMaps Globe Widget
document.addEventListener('DOMContentLoaded', function() {
  try {
    // Remove loading message
    document.getElementById('map-loading').style.display = 'none';
    
    // Clear the container
    document.getElementById('visitor-map').innerHTML = '';
    
    // Create and append your ClustrMaps globe script with custom size
    var script = document.createElement('script');
    script.type = 'text/javascript';
    script.id = 'clstr_globe';
    // Add size parameter to make the globe smaller (w=250 for width, h=250 for height)
    script.src = '//clustrmaps.com/globe.js?d=169QBg4h42ScJHo9ylBQAj3j7I-6IRTfMabyZrKwc6k&w=250&h=250';
    
    // Add error handling for script loading
    script.onerror = function() {
      console.error('Failed to load ClustrMaps script');
      document.getElementById('visitor-map').innerHTML = 
        '<div style="text-align: center; color: #666; padding: 50px;">' +
          '<h4>üåç ClustrMaps Globe</h4>' +
          '<p>Failed to load visitor map. Please try refreshing the page.</p>' +
          '<p>If the problem persists, check your internet connection.</p>' +
        '</div>';
    };
    
    document.getElementById('visitor-map').appendChild(script);
    console.log('ClustrMaps globe script loaded');
    
    // Update visitor statistics
    updateVisitorStats();
    
  } catch (error) {
    console.error('Error loading ClustrMaps:', error);
    document.getElementById('visitor-map').innerHTML = 
      '<div style="text-align: center; color: #666; padding: 50px;">' +
        '<h4>üåç ClustrMaps Globe</h4>' +
        '<p>Error loading visitor map: ' + error.message + '</p>' +
      '</div>';
  }
});

// Function to update visitor statistics
function updateVisitorStats() {
  try {
    // Get current date
    var today = new Date();
    var startDate = new Date();
    startDate.setDate(today.getDate() - 30); // Last 30 days
    
    // Format dates
    var startDateStr = startDate.toLocaleDateString('en-US', { 
      year: 'numeric', 
      month: 'short', 
      day: 'numeric' 
    });
    var endDateStr = today.toLocaleDateString('en-US', { 
      year: 'numeric', 
      month: 'short', 
      day: 'numeric' 
    });
    
    // For now, we'll use a placeholder number
    // In a real implementation, you would fetch this from ClustrMaps API
    var totalVisitors = '1,247'; // This should be replaced with actual data
    
    document.getElementById('visitor-stats').innerHTML = 
      'From ' + startDateStr + ' to ' + endDateStr + ', total visitors: ' + totalVisitors;
      
  } catch (error) {
    console.error('Error updating visitor stats:', error);
    document.getElementById('visitor-stats').innerHTML = 
      'Visitor statistics from the last 30 days';
  }
}
</script> 